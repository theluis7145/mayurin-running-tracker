# ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †æ›¸

## å‰ææ¡ä»¶

ä»¥ä¸‹ã®æƒ…å ±ãŒå¿…è¦ã§ã™ï¼š

- âœ… LINE Channel IDï¼ˆå–å¾—æ¸ˆã¿ï¼‰
- âœ… LINE Channel Secretï¼ˆå–å¾—æ¸ˆã¿ï¼‰
- âœ… LINE Channel Access Tokenï¼ˆå–å¾—æ¸ˆã¿ï¼‰
- â³ Firebase Project IDï¼ˆç¢ºèªãŒå¿…è¦ï¼‰

## Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã®ç¢ºèª

https://console.firebase.google.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ï¼š

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
2. æ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ â†’ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã€
3. ã€Œå…¨èˆ¬ã€ã‚¿ãƒ–ã®ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã€ã‚’ç¢ºèª

ä¾‹: `mayurin-running-tracker`

---

## ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§ï¼š

```bash
# .firebasercãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .firebaserc << 'EOF'
{
  "projects": {
    "default": "YOUR_PROJECT_ID"
  }
}
EOF
```

**YOUR_PROJECT_ID** ã‚’å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—2: LINEæƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š

`functions` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
cd functions
```

ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¿°ï¼š

```env
LINE_CHANNEL_SECRET=YOUR_CHANNEL_SECRET
LINE_CHANNEL_ACCESS_TOKEN=YOUR_CHANNEL_ACCESS_TOKEN
```

**YOUR_CHANNEL_SECRET** ã¨ **YOUR_CHANNEL_ACCESS_TOKEN** ã‚’å®Ÿéš›ã®å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

ã¾ãŸã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ä½œæˆï¼š

```bash
cat > .env << 'EOF'
LINE_CHANNEL_SECRET=YOUR_CHANNEL_SECRET
LINE_CHANNEL_ACCESS_TOKEN=YOUR_CHANNEL_ACCESS_TOKEN
EOF
```

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«æˆ»ã‚‹ï¼š

```bash
cd ..
```

#### è¨­å®šç¢ºèª

```bash
cat functions/.env
```

âœ… è¨­å®šã—ãŸå€¤ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OK

ğŸ’¡ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã«å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã›ã‚“ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—3: Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npx firebase-tools deploy --only firestore:rules
```

âœ… `Deploy complete!` ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°OK

### ã‚¹ãƒ†ãƒƒãƒ—4: Cloud Functionsã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npx firebase-tools deploy --only functions
```

â° ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯5ã€œ10åˆ†ã‹ã‹ã‚Šã¾ã™

ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
âœ”  functions[lineWebhook(asia-northeast1)]: Successful create operation.
Function URL (lineWebhook): https://asia-northeast1-YOUR-PROJECT.cloudfunctions.net/lineWebhook
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                            ã“ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„
```

ğŸ’¡ **lineWebhookã®Function URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼**

### ã‚¹ãƒ†ãƒƒãƒ—5: Webhook URLã‚’è¨­å®š

LINE Developers Consoleã§ï¼š

1. ã€ŒMessaging APIè¨­å®šã€ã‚¿ãƒ–ã‚’é–‹ã
2. ã€ŒWebhook URLã€ã«ã‚³ãƒ”ãƒ¼ã—ãŸURLã‚’è²¼ã‚Šä»˜ã‘
3. ã€Œæ›´æ–°ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ã€ŒWebhookã®åˆ©ç”¨ã€ã‚’**ON**ã«ã™ã‚‹
5. ã€Œæ¤œè¨¼ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

âœ… ã€ŒSuccessã€ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°OKï¼

### ã‚¹ãƒ†ãƒƒãƒ—6: å¿œç­”è¨­å®š

åŒã˜ãƒšãƒ¼ã‚¸ã§ï¼š

- ã€Œå¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€: **OFF**
- ã€ŒWebhookã€: **ON**

### ã‚¹ãƒ†ãƒƒãƒ—7: ã‚ã„ã•ã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®š

LINE Official Account Managerã§ï¼š

1. ã€Œãƒãƒ£ãƒƒãƒˆã€â†’ã€Œã‚ã„ã•ã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€
2. ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šï¼š

```
ã“ã‚“ã«ã¡ã¯ï¼Mayurin Running Trackerã§ã™ğŸƒ

ã“ã®å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‹ã ã¡è¿½åŠ ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼

ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã€‘
1. Mayurin Running Trackerã‚¢ãƒ—ãƒªã‚’é–‹ã
2. ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€â†’ã€Œè¨­å®šã€ã‚¿ãƒ–
3. ã€Œé€£æºã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã€ã‚’ã‚¿ãƒƒãƒ—
4. è¡¨ç¤ºã•ã‚ŒãŸ8æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’ã“ã®ãƒˆãƒ¼ã‚¯ã«é€ä¿¡

é€£æºãŒå®Œäº†ã™ã‚‹ã¨ã€ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’ãŠå±Šã‘ã—ã¾ã™ğŸ’ª
```

### ã‚¹ãƒ†ãƒƒãƒ—8: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

#### Vercelã®å ´åˆ

```bash
git add .
git commit -m "Add LINE Messaging API integration"
git push
```

#### Firebase Hostingã®å ´åˆ

```bash
npm run build
npx firebase-tools deploy --only hosting
```

---

## å‹•ä½œç¢ºèª

### 1. å‹ã ã¡è¿½åŠ ãƒ†ã‚¹ãƒˆ

1. LINEã§å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‹ã ã¡è¿½åŠ 
2. ã‚ã„ã•ã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šãã“ã¨ã‚’ç¢ºèª

### 2. é€£æºãƒ†ã‚¹ãƒˆ

1. ã‚¢ãƒ—ãƒªã«ãƒ­ã‚°ã‚¤ãƒ³
2. ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€â†’ã€Œè¨­å®šã€ã‚¿ãƒ–
3. ã€Œé€£æºã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã€ã‚’ã‚¿ãƒƒãƒ—
4. è¡¨ç¤ºã•ã‚ŒãŸ8æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’LINEãƒˆãƒ¼ã‚¯ã«é€ä¿¡
5. ã€Œâœ… é€£æºãŒå®Œäº†ã—ã¾ã—ãŸï¼ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šãã“ã¨ã‚’ç¢ºèª

### 3. ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ†ã‚¹ãƒˆ

1. ã€Œãƒã‚¤ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã§æ–°ã—ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆ
2. 20åˆ†å¾Œã®æ™‚åˆ»ã‚’è¨­å®š
3. é€šçŸ¥è¨­å®šã‚’ã€Œ15åˆ†å‰ã€ã«å¤‰æ›´
4. ä¿å­˜
5. 15åˆ†å¾Œã«LINEé€šçŸ¥ãŒå±Šãã“ã¨ã‚’ç¢ºèª

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã€ŒNo currently active projectã€ã‚¨ãƒ©ãƒ¼

.firebasercãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚¹ãƒ†ãƒƒãƒ—1ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### Webhookæ¤œè¨¼ãŒå¤±æ•—

1. Cloud FunctionsãŒæ­£å¸¸ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. Webhook URLãŒæ­£ã—ã„ã‹ç¢ºèªï¼ˆlineWebhookã®URLï¼‰
3. ãƒ­ã‚°ã‚’ç¢ºèªï¼š
   ```bash
   npx firebase-tools functions:log --only lineWebhook
   ```

### ç’°å¢ƒå¤‰æ•°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼

```bash
# functions/.env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
cat functions/.env

# ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ã€ã¾ãŸã¯å€¤ãŒæ­£ã—ããªã„å ´åˆã¯å†ä½œæˆ
cd functions
cat > .env << 'EOF'
LINE_CHANNEL_SECRET=YOUR_CHANNEL_SECRET
LINE_CHANNEL_ACCESS_TOKEN=YOUR_CHANNEL_ACCESS_TOKEN
EOF
cd ..

# å†ãƒ‡ãƒ—ãƒ­ã‚¤
npx firebase-tools deploy --only functions
```

---

## å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] .firebasercãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] LINEç’°å¢ƒå¤‰æ•°è¨­å®š
- [ ] Firestoreãƒ«ãƒ¼ãƒ«ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] Cloud Functionsãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] Webhook URLè¨­å®š
- [ ] å¿œç­”è¨­å®šï¼ˆå¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸OFFã€WebhookONï¼‰
- [ ] ã‚ã„ã•ã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­å®š
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] å‹ã ã¡è¿½åŠ ãƒ†ã‚¹ãƒˆ
- [ ] é€£æºãƒ†ã‚¹ãƒˆ
- [ ] ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ†ã‚¹ãƒˆ

ã™ã¹ã¦å®Œäº†ã—ãŸã‚‰ã€LINE Messaging APIé€£æºãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ğŸ‰
